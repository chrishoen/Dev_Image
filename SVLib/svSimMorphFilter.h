#pragma once

/*==============================================================================
Nearest neighbor rule filter.
==============================================================================*/

//******************************************************************************
//******************************************************************************
//******************************************************************************

#include <opencv2/core/core.hpp>

#include "svImageWrapper.h"
#include "svSimMorphParms.h"

namespace SV
{

//******************************************************************************
//******************************************************************************
//******************************************************************************
//******************************************************************************
//******************************************************************************
//******************************************************************************
// This is an image filter that filters pixels according to a set of rules
// that pertain to the nearest neighbors of the pixel.
//

class SimMorphFilter
{
public:

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Parameters. These are read from a parms file.

   SimMorphParms* mP;

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Members.

   // Image wrappers.
   ImageWrapper mInput;
   ImageWrapper mOutput;

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Members.

   // Nearest neighbor variables.
   int m11, m12, m13;
   int m21, m22, m23;
   int m31, m32, m33;

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Constructor.
   SimMorphFilter();
   SimMorphFilter(SimMorphParms* aParms);
   void initialize(SimMorphParms* aParms);
   void reset();

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Generate a first image.
   void doGenerateFirstImage(
      cv::Mat&       aOutput);             // Output

   // Filter an image according to the parms.
   void doFilterImage(
      cv::Mat&       aInput,               // Input
      cv::Mat&       aOutput);             // Output

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Filter a pixel.
   inline void doFilterHighPixel_SquareAdd(RCIndex aX);
   inline void doFilterHighPixel_DiamondAdd(RCIndex aX);
   inline void doFilterHighPixel_SquareSub(RCIndex aX);
   inline void doFilterHighPixel_DiamondSub(RCIndex aX);

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Get nearest neighbors.
   inline void doGetNearestNeighbors(RCIndex aX);
};


//******************************************************************************
//******************************************************************************
//******************************************************************************
}//namespace


