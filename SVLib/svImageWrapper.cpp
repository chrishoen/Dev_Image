/*==============================================================================
Description:
==============================================================================*/

//******************************************************************************
//******************************************************************************
//******************************************************************************

#include "stdafx.h"

#include "svDefs.h"
#include "svPixelFunctions.h"
#include "svImageWrapper.h"

//******************************************************************************
//******************************************************************************
//******************************************************************************

namespace SV
{

//******************************************************************************
//******************************************************************************
//******************************************************************************
// Constructor.

ImageWrapper::ImageWrapper(cv::Mat& aImage)
   : mImage(aImage)
{
}

ImageWrapper::ImageWrapper(cv::Mat* aImage)
   : mImage(*aImage)
{
}


//******************************************************************************
//******************************************************************************
//******************************************************************************
// Element access.

ushort& ImageWrapper::at(RCIndex aPixel)
{
   return mImage.at<ushort>(aPixel.mRow, aPixel.mCol);
}

//******************************************************************************
//******************************************************************************
//******************************************************************************
// Return a scaled value such that 0..100.0 corresponds to 0..65535,
// the minimum to maximum range.

double ImageWrapper::getScaled(RCIndex aPixel)
{
   ushort tValue = mImage.at<ushort>(aPixel.mRow, aPixel.mCol);
   return tValue*cImageScale;
}

//******************************************************************************
//******************************************************************************
//******************************************************************************
// Set a scaled value such that 0..100.0 corresponds to 0..65535,
// the minimum to maximum range.

void ImageWrapper::setScaled(RCIndex aPixel, double aValue)
{
   double tDoubleValue = (65536.0/100.0)*aValue;
   ushort tUShortValue = (ushort)round(tDoubleValue);
   mImage.at<ushort>(aPixel.mRow, aPixel.mCol) = tUShortValue;
}


//******************************************************************************
//******************************************************************************
//******************************************************************************
}//namespace
